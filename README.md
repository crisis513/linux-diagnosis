# linux-diagnosis

KISA에서 작성된 주요정보통신기반시설 기술적 취약점 분석 평가 상세 가이드 문서를 참고하여 기술적인 취약 여부를 검사함으로써 악성코드 유포, 해킹 등 사이버 위협에 대응하기 위해 시작하게 된 프로젝트입니다.

가이드의 문서를 숙지하기 어려운 부분이 많기 때문에 보안 담당자들이 취약점 점검을 자동으로 손쉽게 취약점 진단을 진행할 수 있도록 운영체제 취약점 진단 자동화 스크립트를 개발하고 배포합니다.

취약점 점검을 손쉽게 진행할 수 있도록 자동화 스크립트를 개발하고 진단 결과를 한 눈에 확인할 수 있도록 가시화된 데이터를 제공하는 것을 목표로 합니다.

## How to use

```bash
[son@elk linux-diagnosis]$ sudo ./main_diagnosis.sh client

+-------------------------------------------------------------------+
| 계정관리에 대한 Linux 서버 취약점 분석을 시작합니다.              |
+-------------------------------------------------------------------+

============================= U-01 Start ============================
[Good] 원격 서비스를 사용하지 않고 있거나, 접속이 차단 되어 있습니다.
[Weak] pam_securetty.so 파일을 통한 사용자 인증에 대한 보안이 적용되어 있지 않습니다.
[Info] => vi /etc/pam.d/login 파일에서 해당 내용을 추가하거나 주석을 해제하십시오. 
auth required /lib/security/pam_securetty.so
============================= U-01 End  =============================

============================= U-02 Start ============================
[Weak] 최대 사용 기간 99999일 입니다.
[Weak] 최소 사용 기간 0일 입니다.
[Good] 기간 만료 경고 기간 7일 입니다.
[Info] => vi /etc/login.defs 
pass_warn_age = 7 
pass_max_days = 60 
pass_min_day = 1
============================= U-02 End  =============================

============================= U-03 Start ============================
[Weak] 계정 잠금 임계값이 설정되지 않은 경우 입니다.
[Info] => vi /etc/pam.d/system-auth 확인. 
auth required /lib/security/pam_tally.so deny=5 unlock_time=120 no_magic_root 
account required /lib/security/pam_tally.so no_magic_root reset
============================= U-03 End  =============================

============================= U-04 Start ============================
[Good] Shadow 패스워드 시스템을 사용 중입니다.
============================= U-04 End  =============================

+-------------------------------------------------------------------+
| 파일 및 디렉터리 관리에 대한 Linux 서버 취약점 분석을 시작합니다. |
+-------------------------------------------------------------------+

============================= U-05 Start ============================
[Good] PATH 설정에 문제가 없습니다.
============================= U-05 End  =============================

============================= U-06 Start ============================
[Good] 소유자 혹은 그룹이 없는 파일 및 디렉터리가 존재하지 않습니다.
============================= U-06 End  =============================

============================= U-07 Start ============================
[Weak] /etc/passwd 파일의 소유자 혹은 권한이 잘못 설정되어 있습니다.
[Info] => chown root /etc/passwd 
=> chmod 644 /etc/passwd
============================= U-07 End  =============================

============================= U-08 Start ============================
[Good] 권한: -r--------.
[Good] 소유자: root
[Good] 그룹: root
============================= U-08 End  =============================

============================= U-09 Start ============================
[Weak] /etc/hosts 파일의 소유자 혹은 권한이 잘못 설정되어 있습니다.
[Info] => chown root /etc/hosts 
=> chmod 600 /etc/hosts
============================= U-09 End  =============================

============================= U-10 Start ============================
[Weak] inetd.conf 파일이 존재하지 않습니다
[Weak] xinetd.conf 파일이 존재하지 않습니다
============================= U-10 End  =============================

============================= U-11 Start ============================
[Weak] /etc/rsyslog.conf 파일의 소유자 혹은 권한이 잘못 설정되어 있습니다.
[Info] => chown root /etc/rsyslog.conf 
=> chmod 644 /etc/rsyslog.conf
============================= U-11 End  =============================

============================= U-12 Start ============================
[Good] services 파일 소유자: root
[Good] services 파일 권한: -rw-r--r--.
============================= U-12 End  =============================

============================= U-13 Start ============================
[Good] /usr/bin/chfn 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/chage 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/crontab 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/sudo 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/gpasswd 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/passwd 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/wall 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/ssh-agent 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/pkexec 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/newgrp 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/chsh 파일의 특수 권한이 설정되어 있습니다.
[Good] /sbin/unix_chkpwd 파일의 특수 권한이 설정되어 있습니다.
[Weak] /bin/ping 파일의 특수 권한이 설정되어 있지 않습니다.
[Good] /bin/su 파일의 특수 권한이 설정되어 있습니다.
[Good] /bin/mount 파일의 특수 권한이 설정되어 있습니다.
[Good] /bin/umount 파일의 특수 권한이 설정되어 있습니다.
============================= U-13 End  =============================

============================= U-14 Start ============================
[Good] test.csv파일의 소유자, 권한이 안전합니다.
[Good] .tcshrc파일의 소유자, 권한이 안전합니다.
[Good] .cshrc파일의 소유자, 권한이 안전합니다.
[Good] .bashrc파일의 소유자, 권한이 안전합니다.
[Good] .bash_profile파일의 소유자, 권한이 안전합니다.
[Good] .bash_logout파일의 소유자, 권한이 안전합니다.
[Good] anaconda-ks.cfg파일의 소유자, 권한이 안전합니다.
[Good] .viminfo파일의 소유자, 권한이 안전합니다.
[Good] .bash_history파일의 소유자, 권한이 안전합니다.
[Good] id_rsa.pub파일의 소유자, 권한이 안전합니다.
[Good] id_rsa파일의 소유자, 권한이 안전합니다.
[Good] known_hosts파일의 소유자, 권한이 안전합니다.
============================= U-14 End  =============================

============================= U-16 Start ============================
[Good] 존재하지 않는 Device 파일이 없습니다.
============================= U-16 End  =============================

============================= U-17 Start ============================
[Good] /etc/hosts.equiv 파일을 사용하고 있지 않습니다.
[Good] $HOME/.rhosts 파일을 사용하고 있지 않습니다.
============================= U-17 End  =============================

[client] 호스트의 진단을 시작합니다.

diagnosis_script.debug                                             100% 1006KB  35.4MB/s   00:00    
U-13_filelist                                                      100%  262   110.7KB/s   00:00    
main_diagnosis.sh                                                  100%  726   398.5KB/s   00:00    
diagnosis_1                                                        100% 4344     2.9MB/s   00:00    
diagnosis_2                                                        100%   10KB   5.8MB/s   00:00    
function                                                           100% 1709     1.0MB/s   00:00    
Last failed login: Thu Aug 27 16:36:29 KST 2020 from 192.168.56.101 on ssh:notty
There was 1 failed login attempt since the last successful login.

+-------------------------------------------------------------------+
| 계정관리에 대한 Linux 서버 취약점 분석을 시작합니다.              |
+-------------------------------------------------------------------+

============================= U-01 Start ============================
[Good] 원격 서비스를 사용하지 않고 있거나, 접속이 차단 되어 있습니다.
[Weak] pam_securetty.so 파일을 통한 사용자 인증에 대한 보안이 적용되어 있지 않습니다.
[Info] => vi /etc/pam.d/login 파일에서 해당 내용을 추가하거나 주석을 해제하십시오. 
auth required /lib/security/pam_securetty.so
============================= U-01 End  =============================

============================= U-02 Start ============================
[Weak] 최대 사용 기간 99999일 입니다.
[Weak] 최소 사용 기간 0일 입니다.
[Good] 기간 만료 경고 기간 7일 입니다.
[Info] => vi /etc/login.defs 
pass_warn_age = 7 
pass_max_days = 60 
pass_min_day = 1
============================= U-02 End  =============================

============================= U-03 Start ============================
[Weak] 계정 잠금 임계값이 설정되지 않은 경우 입니다.
[Info] => vi /etc/pam.d/system-auth 확인. 
auth required /lib/security/pam_tally.so deny=5 unlock_time=120 no_magic_root 
account required /lib/security/pam_tally.so no_magic_root reset
============================= U-03 End  =============================

============================= U-04 Start ============================
[Good] Shadow 패스워드 시스템을 사용 중입니다.
============================= U-04 End  =============================

+-------------------------------------------------------------------+
| 파일 및 디렉터리 관리에 대한 Linux 서버 취약점 분석을 시작합니다. |
+-------------------------------------------------------------------+

============================= U-05 Start ============================
[Good] PATH 설정에 문제가 없습니다.
============================= U-05 End  =============================

============================= U-06 Start ============================
[Good] 소유자 혹은 그룹이 없는 파일 및 디렉터리가 존재하지 않습니다.
============================= U-06 End  =============================

============================= U-07 Start ============================
[Weak] /etc/passwd 파일의 소유자 혹은 권한이 잘못 설정되어 있습니다.
[Info] => chown root /etc/passwd 
=> chmod 644 /etc/passwd
============================= U-07 End  =============================

============================= U-08 Start ============================
[Good] 권한: ----------.
[Good] 소유자: root
[Good] 그룹: root
============================= U-08 End  =============================

============================= U-09 Start ============================
[Weak] /etc/hosts 파일의 소유자 혹은 권한이 잘못 설정되어 있습니다.
[Info] => chown root /etc/hosts 
=> chmod 600 /etc/hosts
============================= U-09 End  =============================

============================= U-10 Start ============================
[Weak] inetd.conf 파일이 존재하지 않습니다
[Weak] xinetd.conf 파일이 존재하지 않습니다
============================= U-10 End  =============================

============================= U-11 Start ============================
[Weak] /etc/rsyslog.conf 파일의 소유자 혹은 권한이 잘못 설정되어 있습니다.
[Info] => chown root /etc/rsyslog.conf 
=> chmod 644 /etc/rsyslog.conf
============================= U-11 End  =============================

============================= U-12 Start ============================
[Good] services 파일 소유자: root
[Good] services 파일 권한: -rw-r--r--.
============================= U-12 End  =============================

============================= U-13 Start ============================
[Good] /usr/bin/chfn 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/chage 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/crontab 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/sudo 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/gpasswd 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/passwd 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/wall 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/ssh-agent 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/pkexec 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/newgrp 파일의 특수 권한이 설정되어 있습니다.
[Good] /usr/bin/chsh 파일의 특수 권한이 설정되어 있습니다.
[Good] /sbin/unix_chkpwd 파일의 특수 권한이 설정되어 있습니다.
[Weak] /bin/ping 파일의 특수 권한이 설정되어 있지 않습니다.
[Good] /bin/su 파일의 특수 권한이 설정되어 있습니다.
[Good] /bin/mount 파일의 특수 권한이 설정되어 있습니다.
[Good] /bin/umount 파일의 특수 권한이 설정되어 있습니다.
============================= U-13 End  =============================

============================= U-14 Start ============================
[Good] .tcshrc파일의 소유자, 권한이 안전합니다.
[Good] .cshrc파일의 소유자, 권한이 안전합니다.
[Good] .bashrc파일의 소유자, 권한이 안전합니다.
[Good] .bash_profile파일의 소유자, 권한이 안전합니다.
[Good] .bash_logout파일의 소유자, 권한이 안전합니다.
[Good] anaconda-ks.cfg파일의 소유자, 권한이 안전합니다.
[Good] .viminfo파일의 소유자, 권한이 안전합니다.
[Good] .bash_history파일의 소유자, 권한이 안전합니다.
[Good] authorized_keys파일의 소유자, 권한이 안전합니다.
============================= U-14 End  =============================

============================= U-16 Start ============================
[Good] 존재하지 않는 Device 파일이 없습니다.
============================= U-16 End  =============================

============================= U-17 Start ============================
[Good] /etc/hosts.equiv 파일을 사용하고 있지 않습니다.
[Good] $HOME/.rhosts 파일을 사용하고 있지 않습니다.
============================= U-17 End  =============================
```
